name: Use Shared Ansible Lint Workflow

on: [push, pull_request]

jobs:
  call-shared-workflow:
    uses: AdrienMS-Cap/tst-shared-pipeline/.github/workflows/ansible-lint.yml@main
    with:
      repository: ${{ github.repository }}
      token: ${{ secrets.MY_PAT }} # or your PAT if necessary

  push-to-production:
    runs-on: ubuntu-latest
    needs: [call-shared-workflow]
    if: ${{ needs.call-shared-workflow.result == 'success' }}
    steps:
    - name: Checkout Code
      uses: actions/checkout@v2
      with:
        ref: main
        token: ${{ secrets.PAT_MAX }}
    - name: Push to Main-Production
      run: |
        git checkout -b main-production
        git push https://${{ secrets.MY_PAT }}@github.com/${{ github.repository }}/main-production
