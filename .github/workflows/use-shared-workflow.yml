name: Use Shared Ansible Lint Workflow

on: [push, pull_request]

jobs:
  call-shared-workflow:
    uses: AdrienMS-Cap/tst-shared-pipeline/.github/workflows/ansible-lint.yml@main
    secrets: inherit
    with:
      repository: ${{ github.repository }}

  push-to-production:
    runs-on: ubuntu-latest
    needs: [call-shared-workflow]
    if: ${{ needs.call-shared-workflow.result == 'success' }}
    steps:
    - name: Checkout Code
      uses: actions/checkout@v2
      with:
        ref: main
    - name: Push to Main-Production
      run: |
        git checkout -b main-production
        git config user.name "mypipelienname"
        git config user.email "test@mail.com"
        git push https://${{ secrets.PAT_MAX }}@github.com/XXX/tst-repo1.git main-production

